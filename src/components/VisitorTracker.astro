---
// Visitor tracking component
// This component sends page view data to your analytics API
---

<script>
  if (typeof window !== 'undefined') {
    // Configuration - Update this with your API endpoint
    const API_BASE = import.meta.env.PUBLIC_ANALYTICS_API || 'https://analytics-api-one.vercel.app/api';
    const API_ENDPOINT = `${API_BASE}/track`;
    
    // Only track once per page load
    let tracked = false;
    
    const trackVisit = async () => {
      if (tracked) return;
      tracked = true;
      
      try {
        const pageData = {
          path: window.location.pathname,
          referrer: document.referrer || 'direct',
          userAgent: navigator.userAgent,
          timestamp: new Date().toISOString(),
          screenWidth: window.screen.width,
          screenHeight: window.screen.height,
          language: navigator.language,
        };
        
        // Debug logging (remove in production if desired)
        console.log('Tracking visit to:', API_ENDPOINT, pageData);
        
        // Send to API
        const response = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(pageData),
          // Don't wait for response to avoid blocking page load
          keepalive: true,
        });
        
        if (!response.ok) {
          console.warn('Analytics tracking failed:', response.status, response.statusText);
        } else {
          console.log('Visit tracked successfully');
        }
      } catch (error) {
        // Log error for debugging
        console.error('Analytics tracking error:', error);
      }
    };
    
    // Track on page load
    if (document.readyState === 'complete') {
      trackVisit();
    } else {
      window.addEventListener('load', trackVisit);
    }
  }
</script>

